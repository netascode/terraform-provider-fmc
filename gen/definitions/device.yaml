---
name: Device
rest_endpoint: /api/fmc_config/v1/domain/{DOMAIN_UUID}/devices/devicerecords
doc_category: Devices
test_tags: [TF_VAR_device_registration_key,TF_VAR_license_capabilities]
attributes:
# General
  - model_name: name
    type: String
    mandatory: true
    description: User-specified name, must be unique.
    data_source_query: true
    example: my_device
  # type is set twice on purpose - to make sure this is part of POST request and to make it computed field
  - model_name: type
    type: String
    description: Type of the device; this value is always 'Device'.
    value: Device
  - model_name: type
    type: String
    description: Type of the device; this value is always 'Device'.
    computed: true
  - model_name: hostName
    type: String
    description: Hostname or IP address of the device. Either the host_name or nat_id must be present.
    mandatory: true
    example: 10.0.0.1
    test_value: var.ftd_addr
  - model_name: natID
    tf_name: nat_id
    type: String
    description: (used for device registration behind NAT) If the device to be registered and the Firepower Management Center are separated by network address translation (NAT), set a unique string identifier.
    write_only: true
    exclude_example: true
    exclude_test: true
  - model_name: license_caps
    tf_name: license_capabilities
    type: Set
    element_type: String
    mandatory: true
    enum_values: [ ESSENTIALS, IPS, URL, MALWARE_DEFENSE, CARRIER, SECURE_CLIENT_PREMIER, SECURE_CLIENT_PREMIER_ADVANTAGE, SECURE_CLIENT_VPNOnly, BASE, THREAT, PROTECT, CONTROL, URLFilter, MALWARE, VPN, SSL ]
    description: "Array of strings representing the license capabilities on the managed device. ESSENTIALS is mandatory"
    example: ESSENTIALS
    test_value: "[var.license_capabilities]"
  - model_name: regKey
    tf_name: registration_key
    type: String
    mandatory: true
    description: Registration Key identical to the one previously configured on the device (`configure manager`).
    example: key1
    write_only: true
    test_value: var.device_registration_key
  - model_name: id
    tf_name: device_group_id
    data_path: [ deviceGroup ]
    type: String
    description: Id of the device group.
    exclude_example: true
    exclude_test: true
  - model_name: prohibitPacketTransfer
    type: Bool
    description: Value true prohibits the device from sending packet data with events to the Firepower Management Center. Value false allows the transfer when a certain event is triggered. Not all traffic data is sent; connection events do not include a payload, only connection metadata.
    exclude_example: true
    exclude_test: true
  - model_name: performanceTier
    type: String
    description: Performance tier for the managed device, applicable only to vFTD devices >=6.8.0.
    enum_values: [FTDv5, FTDv10, FTDv20, FTDv30, FTDv50, Legacy]
    example: FTDv5
  - model_name: snortEngine
    type: String
    description: Performance tier for the managed device, applicable only to vFTD devices >=6.8.0.
    enum_values: [ SNORT2, SNORT3]
    example: SNORT3
  - model_name: enableOGS
    data_path: [ advanced ]
    tf_name: object_group_search
    type: Bool
    description: Enables Object Group Search
    example: "true"
    exclude_test: true
# Policy assignments
  - model_name: id
    tf_name: access_policy_id
    type: String
    mandatory: true
    data_path: [ accessPolicy ]
    description: Id of the assigned Access Control Policy. For example `fmc_access_control_policy.example.id`.
    example: 76d24097-41c4-4558-a4d0-a8c07ac08470
    test_value: fmc_access_control_policy.test.id
  - model_name: dummy_nat_policy_id
    tf_name: nat_policy_id
    type: String
    description: Id of the assigned FTD NAT policy.
    exclude_example: true
    exclude_test: true
  - model_name: id
    data_path: [ healthPolicy ]
    tf_name: health_policy_id
    type: String
    description: Id of the assigned Health policy.
    exclude_example: true
    exclude_test: true
# Computed - informational only
  - model_name: sw_version
    tf_name: info_version
    type: String
    description: Version of the registered device - Informational only.
    computed: true
    computed_refresh_value: true
  - model_name: healthStatus
    tf_name: info_health_status
    type: String
    description: Health Status of the device - Informational only.
    computed: true
    computed_refresh_value: true
  - model_name: healthMessage
    tf_name: info_health_message
    type: String
    description: Health Message of the device - Informational only.
    computed: true
    computed_refresh_value: true
  - model_name: isConnected
    tf_name: info_is_connected
    type: Bool
    description: Shows if the device is connected - Informational only.
    computed: true
    computed_refresh_value: true
  - model_name: deploymentStatus
    tf_name: info_deployment_status
    type: String
    description: Shows deployment status - Informational only.
    computed: true
    computed_refresh_value: true
  - model_name: ftdMode
    tf_name: info_ftd_mode
    type: String
    description: FTD Mode - Informational only.
    computed: true
    computed_refresh_value: true
  - model_name: deviceSerialNumber
    data_path: [ metadata ]
    tf_name: info_device_serial_number
    type: String
    description: Device Serial Number - Informational only.
    computed: true
    computed_refresh_value: true
  - model_name: snortVersion
    data_path: [ metadata ]
    tf_name: info_snort_version
    type: String
    description: Snort Version - Informational only.
    computed: true
    computed_refresh_value: true
  - model_name: vdbVersion
    data_path: [ metadata ]
    tf_name: info_vdb_version
    type: String
    description: VDB Version - Informational only.
    computed: true
    computed_refresh_value: true
  - model_name: lspVersion
    data_path: [ metadata ]
    tf_name: info_lsp_version
    type: String
    description: LSP Version - Informational only.
    computed: true
    computed_refresh_value: true
  - model_name: name
    tf_name: info_deployed_access_policy_name
    data_path: [ accessPolicy ]
    type: String
    description: Deployed Access Control Policy Name - Informational only.
    computed: true
    computed_refresh_value: true
  - model_name: name
    tf_name: info_deployed_health_policy_name
    data_path: [ healthPolicy ]
    type: String
    description: Deployed Health Policy Name - Informational only.
    computed: true
    computed_refresh_value: true

test_prerequisites: |-
  resource "fmc_access_control_policy" "test" {
    name = "fmc_device_access_control_policy"
    default_action = "BLOCK"
  }

  variable "ftd_addr" { default = null } // tests will set $TF_VAR_ftd_addr
  variable "device_registration_key" {} // tests will set $TF_VAR_device_registration_key
  variable "license_capabilities" { default = "BASE" } // tests will set $TF_VAR_license_capabilities
