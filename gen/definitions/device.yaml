---
name: Device
rest_endpoint: /api/fmc_config/v1/domain/{DOMAIN_UUID}/devices/devicerecords
# data_source_name_query: true
doc_category: Devices
test_tags: [FTD_ADDR]
attributes:
  - model_name: name
    type: String
    mandatory: true
    description: User-specified name of the registered device. Must be unique.
    example: device1
    minimum_test_value: '"device1alt"'
  - model_name: hostName
    type: String
    mandatory: true
    description: Hostname or IP address of the device. If the device is behind NAT, you can leave the host_name as blank, and use the nat_id field. Use the same nat_id string that you used while configuring FMC on the device.
    example: 10.0.0.1
    test_value: var.ftd_addr
  - model_name: license_caps
    type: List
    element_type: String
    mandatory: true
    description: "Array of strings representing the license capabilities on the managed device. For registering FTD, the allowed values are: BASE (mandatory), THREAT, URLFilter, MALWARE, APEX, PLUS, VPNOnly. For Firepower ASA or NGIPSv devices, allowed values are: BASE, THREAT, PROTECT, CONTROL, URLFilter, MALWARE, VPN, SSL."
    example: BASE
  - model_name: regKey
    type: String
    mandatory: true
    description: Registration Key that you entered while configuring FMC on the device.
    example: key1
    write_only: true
    test_value: var.reg_key
  - model_name: type
    type: String
    description: Type of the device; this value is always Device.
    exclude_example: true
    requires_replace: true
    default_value: Device
    example: Device
  - tf_name: access_policy_id
    type: String
    mandatory: true
    model_name: id
    data_path:
      - accessPolicy
    # Current api has POST but ignores PUT. TODO: is there another api?
    requires_replace: true
    description: The currently assigned access control policy. You need to specify an existing access control policy when creating a device.
    example: fmc_access_control_policy.test.id
    test_value: fmc_access_control_policy.test.id

test_prerequisites: |
  resource "fmc_access_control_policy" "test" {
    name = "POLICY1"
    default_action = "BLOCK"
  }

  variable "ftd_addr" {} // tests will set $TF_VAR_ftd_addr

  variable "reg_key" {} // tests will set $TF_VAR_reg_key
